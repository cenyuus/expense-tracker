---
name: 记账应用开发计划
overview: ""
todos: []
---

# 记账应用开发计划

## 项目概述

创建一个简约风格的记账应用，支持日常消费记录和天/周/月/年维度的消费统计可视化。使用 Next.js + Supabase + Apache ECharts 技术栈。**重要要求**: 界面必须完全响应式，支持手机和电脑端使用，确保在不同设备上都有良好的用户体验。

## 技术栈

- **框架**: Next.js 15 (App Router)
- **数据库**: Supabase PostgreSQL
- **认证**: Supabase Auth
- **UI**: Tailwind CSS + shadcn/ui
- **图表**: Apache ECharts (echarts + echarts-for-react)
- **语言**: TypeScript

## 数据库设计

### expenses 表结构

```sql
CREATE TABLE expenses (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  date DATE NOT NULL,
  time_period VARCHAR(10) NOT NULL CHECK (time_period IN ('上午', '中午', '下午', '晚上')),
  item_name TEXT NOT NULL,
  amount DECIMAL(10, 2) NOT NULL CHECK (amount > 0),
  payment_method VARCHAR(50) NOT NULL CHECK (payment_method IN ('兴业银行信用卡', '浦发红沙宣', 'inmotion香港信用卡', '招商储蓄卡')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_expenses_user_date ON expenses(user_id, date DESC);
CREATE INDEX idx_expenses_user_created ON expenses(user_id, created_at DESC);
```



### RLS 策略

- 用户只能查看和操作自己的数据
- 启用 Row Level Security

## 项目结构

```javascript
expense-tracker/
├── app/
│   ├── layout.tsx              # 根布局（包含认证检查）
│   ├── page.tsx                 # 记账表单页面（首页）
│   ├── stats/
│   │   └── page.tsx             # 统计可视化页面
│   ├── auth/
│   │   ├── login/
│   │   │   └── page.tsx         # 登录页面
│   │   └── signup/
│   │       └── page.tsx         # 注册页面
│   └── api/
│       └── expenses/
│           └── route.ts         # API 路由（可选，用于服务端操作）
├── components/
│   ├── ui/                      # shadcn/ui 组件
│   ├── expense-form.tsx         # 记账表单组件
│   ├── today-summary.tsx        # 今日消费汇总组件
│   ├── stats-charts.tsx         # 统计图表组件
│   └── auth-button.tsx          # 认证按钮组件
├── lib/
│   ├── supabase/
│   │   ├── client.ts            # 客户端 Supabase 实例
│   │   ├── server.ts            # 服务端 Supabase 实例
│   │   └── middleware.ts        # 中间件 Supabase 实例
│   └── utils.ts                 # 工具函数
├── sql/
│   └── init.sql                 # 数据库初始化脚本
├── middleware.ts                # Next.js 中间件（认证保护）
└── package.json
```



## 核心功能实现

### 1. 记账表单页面 (`app/page.tsx`)

- **顶部**: 今日消费汇总卡片（实时显示今天总花费）
- **表单区域**:
- 日期选择器（默认今天）+ 时间段选择（上午/中午/下午/晚上）
- 商品名称输入
- 金额输入（数字，保留两位小数）
- 支付方式单选（4个选项）
- 提交按钮
- **底部**: 跳转到统计页面的入口按钮/链接
- **数据提交**: 使用客户端 Supabase 客户端直接插入数据
- **响应式设计**:
- 移动端（≤768px）：单列布局，全宽表单元素，大号触摸目标（最小 44x44px），减少左右边距（px-4）
- 平板端（768px-1024px）：居中卡片布局，最大宽度 600px
- 桌面端（≥1024px）：居中布局，最大宽度 800px，舒适的间距

### 2. 统计可视化页面 (`app/stats/page.tsx`)

- **时间维度切换**: 天/周/月/年 标签页或选择器
- **图表展示**:
- 消费趋势折线图（按时间）
- 支付方式饼图（占比）
- 消费金额柱状图（按日期/周/月/年）
- **数据统计卡片**:
- 总消费金额
- 平均每日消费
- 最高单笔消费
- 最常用支付方式
- **数据查询**: 根据选择的时间维度，使用 Supabase 查询对应时间段的数据
- **响应式设计**:
- 移动端：图表垂直堆叠，统计卡片单列显示，图表高度自适应（300-400px）
- 平板端：图表可并排显示（2列），统计卡片网格布局（2列）
- 桌面端：图表充分利用空间，统计卡片网格布局（2x2），图表高度固定（400-500px）
- ECharts 响应式配置：使用 `resize` 事件监听窗口变化，自动调整图表尺寸

### 3. 认证系统

- 使用 Supabase Auth 实现邮箱密码登录/注册
- Middleware 保护需要认证的路由
- 未登录用户重定向到登录页
- **响应式设计**: 登录/注册表单在移动端和桌面端都居中显示，适配不同屏幕尺寸

### 4. 数据查询逻辑

- **今日消费**: 查询当天所有记录，按时间段排序
- **天维度**: 查询指定日期所有记录
- **周维度**: 查询周一到周日的记录，按天聚合
- **月维度**: 查询指定月份所有记录，按天聚合
- **年维度**: 查询指定年份所有记录，按月聚合

## 响应式设计详细规范

### 移动端优化 (≤768px)

- **布局**:
- 单列布局，内容全宽显示
- 减少左右边距（px-4），充分利用屏幕空间
- 垂直堆叠所有元素，避免横向滚动
- **交互元素**:
- 按钮和输入框高度至少 44px（触摸友好标准）
- 支付方式选择使用大号单选按钮或卡片式选择
- 日期选择器使用原生移动端日期选择器
- **字体大小**:
- 页面标题：20-24px
- 表单标签：16px
- 输入框文字：16px（防止 iOS 自动缩放）
- 按钮文字：16-18px
- **图表**:
- 图表高度：300-400px
- 图表字体缩小（10-12px）
- 图例位置调整到图表下方或隐藏（可展开查看）
- 使用 SVG 渲染器提升移动端性能

### 平板端优化 (768px-1024px)

- **布局**:
- 内容居中显示，最大宽度限制
- 表单最大宽度：600px
- 图表可并排显示（2列网格）
- **统计卡片**:
- 2列网格布局
- 卡片间距适中

### 桌面端优化 (≥1024px)

- **布局**:
- 内容区域居中，最大宽度 1200px
- 充分利用屏幕空间
- 舒适的间距和留白
- **交互**:
- 悬停效果增强交互体验
- 鼠标悬停显示详细信息
- 键盘导航支持
- **图表**:
- 图表高度：400-500px
- 图表可并排显示
- 完整的图例和标签

### 通用响应式原则

- **Tailwind CSS 响应式工具类**:
- `sm:` (640px+) - 小屏幕
- `md:` (768px+) - 平板
- `lg:` (1024px+) - 桌面
- `xl:` (1280px+) - 大桌面
- **媒体查询示例**:
  ```tsx
    <div className="px-4 md:px-6 lg:px-8">
      <div className="w-full md:max-w-2xl lg:max-w-4xl mx-auto">
        {/* 内容 */}
      </div>
    </div>
  ```




- **图片和媒体**:
- 使用 `max-w-full` 防止溢出
- 图片使用 `object-fit` 保持比例
- **表格处理**:
- 小屏幕上表格可横向滚动
- 或改为卡片布局展示
- **测试要求**:
- 测试横屏和竖屏两种方向
- 测试不同设备尺寸（iPhone SE, iPhone 14, iPad, 桌面）
- 确保所有交互元素易于点击

## 关键文件

### [app/page.tsx](app/page.tsx)

主记账表单页面，包含表单和今日汇总

### [app/stats/page.tsx](app/stats/page.tsx)

统计可视化页面，使用 Apache ECharts 展示多维度数据

### [components/expense-form.tsx](components/expense-form.tsx)

记账表单组件，处理表单提交和数据验证，实现响应式布局

### [components/today-summary.tsx](components/today-summary.tsx)

今日消费汇总组件，实时查询并显示今日总花费

### [components/stats-charts.tsx](components/stats-charts.tsx)

统计图表组件，使用 Apache ECharts 封装图表逻辑

- 使用 `echarts-for-react` 组件集成 ECharts
- 实现折线图、饼图、柱状图等图表类型
- 支持响应式布局和主题配置
- 移动端图表自适应高度和字体大小

### [lib/supabase/client.ts](lib/supabase/client.ts)

Supabase 客户端实例

### [lib/supabase/server.ts](lib/supabase/server.ts)

Supabase 服务端实例

### [sql/init.sql](sql/init.sql)

数据库表结构和 RLS 策略初始化脚本

### [middleware.ts](middleware.ts)

Next.js 中间件，处理认证和路由保护

## 实施步骤

1. **项目初始化**

- 创建 Next.js 项目
- 安装依赖（Supabase, Apache ECharts, shadcn/ui）
- 配置 Tailwind CSS 和 TypeScript
- 设置响应式断点配置

2. **Supabase 配置**

- 创建数据库表结构
- 配置 RLS 策略
- 设置环境变量

3. **认证系统**

- 实现登录/注册页面（响应式设计）
- 配置 middleware 路由保护
- 创建认证相关组件

4. **记账表单页面**

- 实现表单组件（响应式布局）
- 实现今日汇总组件
- 添加数据提交逻辑
- 移动端触摸优化

5. **统计可视化页面**

- 实现时间维度切换（响应式标签页）
- 集成 Apache ECharts 图表（响应式配置）
- 实现数据查询和聚合逻辑
- 移动端图表优化

6. **响应式设计与样式优化**

- 应用简约风格设计
- 实现移动端、平板端、桌面端布局
- 图表响应式配置和自适应
- 触摸友好的交互设计
- 跨设备测试和优化

## 依赖包

- `next`: Next.js 框架
- `@supabase/ssr`: Supabase SSR 支持
- `@supabase/supabase-js`: Supabase 客户端
- `echarts`: Apache ECharts 核心库（参考: https://github.com/apache/echarts）
- `echarts-for-react`: React ECharts 封装组件
- `tailwindcss`: 样式框架（响应式设计支持）
- `@radix-ui/*`: UI 组件基础库（通过 shadcn/ui）

## ECharts 集成说明

根据 [Apache ECharts 官方仓库](https://github.com/apache/echarts)，使用以下方式集成：

1. **安装依赖**:
   ```bash
      npm install echarts echarts-for-react
   ```




2. **在组件中使用**:
   ```tsx
      import ReactECharts from 'echarts-for-react';
      
      <ReactECharts 
        option={chartOption} 
        style={{ height: '400px' }}
        opts={{ renderer: 'svg' }} // 移动端使用 SVG 渲染器性能更好
      />
   ```




3. **图表类型**:

- 折线图：消费趋势（按时间）
- 饼图：支付方式占比
- 柱状图：消费金额统计（按日期/周/月/年）

4. **响应式配置**:

- 使用 ECharts 的 `resize` API 监听窗口变化
- 移动端图表配置：减小字体、调整图例位置、优化触摸交互
- 使用 `useEffect` 和 `window.addEventListener('resize')` 实现自适应